variables:
  DOMAIN: "uscip.api"

Deploy:
  stage: build
  script:
     - git pull origin develop
     - rm -f -r /home/gitlab-runner/$CI_PROJECT_DIR/.git
     - "/home/gitlab-runner/xeroxup1.sh $CI_PROJECT_DIR $CI_BUILD_REF $DOMAIN"
     - ssh -p 5253 -tt sadist@95.216.36.104 'cp /home/sadist/kubernetes/uscip.api/.env.example /home/sadist/kubernetes/uscip.api/.env'
     - ssh -p 5253 -tt sadist@95.216.36.104 'cd /home/sadist/kubernetes/uscip.api/ && docker build -t sadist/uscip-api . && docker login && docker push sadist/uscip-api && kubectl delete deployment deployment-uscip-api && kubectl create configmap uscip-api-env-file --from-env-file=.env -o yaml --dry-run | kubectl replace -f -&& kubectl apply -f deployment-uscip-api.yaml'
  only:
    - develop